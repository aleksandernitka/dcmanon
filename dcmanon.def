# Generated by Neurodocker and Reproenv.

Bootstrap: docker
From: debian:bullseye-slim

%labels
  Author: aleksandernitka
  Maintainer: aleksandernitka

%help
  This definition is for an image with dcmanon installed. Contains python 3.11 and pydicom.

%environment
  export CONDA_DIR="/opt/miniconda-latest"
  export PATH="/opt/miniconda-latest/bin:$PATH"

%post
  apt-get update -qq
  apt-get install -y -q --no-install-recommends \
      bzip2 \
      ca-certificates \
      curl \
      git-all \
      vim
  rm -rf /var/lib/apt/lists/*

  # Install dependencies.
  export PATH="/opt/miniconda-latest/bin:$PATH"
  echo "Downloading Miniconda installer ..."
  conda_installer="/tmp/miniconda.sh"
  curl -fsSL -o "$conda_installer" https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
  bash "$conda_installer" -b -p /opt/miniconda-latest
  rm -f "$conda_installer"
  conda update -yq -nbase conda
  # Prefer packages in conda-forge
  conda config --system --prepend channels conda-forge
  # Packages in lower-priority channels not considered if a package with the same
  # name exists in a higher priority channel. Can dramatically speed up installations.
  # Conda recommends this as a default
  # https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-channels.html
  conda config --set channel_priority strict
  conda config --system --set auto_update_conda false
  conda config --system --set show_channel_urls true
  # Enable `conda activate`
  conda init bash
  conda install -y  --name base \
      "python=3.11" \
      "tqdm" \
      "pandas"
  # Clean up
  sync && conda clean --all --yes && sync
  rm -rf ~/.cache/pip/*

  # Insstall pydicom
  conda install pydicom
  # Install dcmanon
  git clone https://github.com/aleksandernitka/dcmanon.git

%runscript
  echo "Arguments received: $*"
  python /dcmanon/dcmanon.py $*